import crypt
import os
import sys
# This will generate random salts for each machine which is deployed, same password but different outputs preventing hash table attacks
salt = crypt.mksalt(crypt.METHOD_SHA512)
# Password added as a command line argument
password = sys.argv[1]
# Use os.system to use sed and erase current line of root
"""
backup = os.system("cp /etc/shadow /etc/shadow.bak")
# If the backup file is successfully created or not.
if backup == 0:
	print("All good")
else:
	print("Not good")
"""
print("Password hash output")
# The encrypted password and salt embedded into a root password hash
pw_hash = "root:{}::0:99999:7:::".format(crypt.crypt(password, salt))
# Hash is printed to see it's actually correct 
print(pw_hash)
# Delete the first line of the shadow file which is the old root hash
delete_line = os.system("sed -i 1d /etc/shadow")
# Replace the first line with the new hash on the first line
add_line = os.system("sed -i '1i {}' /etc/shadow".format(pw_hash))
